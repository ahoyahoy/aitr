## Minimalní architektura (real)

* **Index POI → H3 (res 9–10)**: `cell -> [POI]` (+ kategorie, rating, cena).
* **Rychlé síto vzdálenosti/času → OSRM**

  * `/table` (foot/bike/car) pro stovky kandidátů v batchích.
  * seřadíš podle ETA (případně penalizace typů cest v Lua profilu).
* **Finální verifikace → Google Directions**

  * jen TOP N (10–20) → přesné časy, zavírky, polyline.
* **Skládání dne**: greedy cluster (H3 kRing) → pořadí 2-opt → ověřit segmenty Googlem.
* **UI**: magazínové karty (hotel/POI/mapa/časová osa), chat jako QA vrstva.
* **Prodej**: affiliate deeplinky z partner API.

## Flow (kroky)

1. Uživatel: město + prefer. chůze/kolo/auto + rozpočet.
2. **H3 nearby**: `userCell -> kRing(r)` → kandidáti POI (filtr kategorie/cena).
3. **OSRM /table**: batch durations (např. 1×N, případně M×N) → TOP 30.
4. **Rank**: ETA + (rating, cena, otevřeno v čase návštěvy).
5. **Google Directions** pro TOP 10–20 → validace + přesné ETA.
6. **Itinerář den**: cluster POI do bloků (H3) → 2-opt pořadí → potvrdit segmenty Googlem.
7. Vykreslit mapu + karty + CTA „Book“.

## Latence (cílově)

* H3 lookup + Redis: 10–30 ms
* OSRM `/table` (200 POI, foot): 80–200 ms (lokálně, MLD)
* Google Directions (10–20 callů paralelně): 200–600 ms
* Orchestrace + render: TTFB \~600–1200 ms (stream textu, mapy po načtení)

## Data model (stručně)

* `poi{id, lat, lon, h3_res9, categories[], rating, price_band, source_id}`
* `h3_cell -> poi_ids` (Redis set/list)
* `poi_live` join (ceny/dostupnost) z partner API při dotazu

## Co pohlídat

* **OSM kvalita**: občas šumy → řeší finální Google check.
* **Batching**: omez `/table` velikost (např. 100 dest. na batch).
* **Časové okno**: filtruj POI podle otevíraček dřív než voláš Google.
* **Caching**: cache H3→POI, OSRM `/table`, a Google polylines (timebucket 30–60 min).

## MVP dodávka (scope)

* Region 1 města (např. Melbourne CBD + okolí).
* Profily: `foot` (OSRM) + Google jako ground truth.
* Kategorie: 2–3 typy POI (hotely, kavárny, muzea).

**Verdikt:** Tohle MVP je **realistické a funkční**. H3 dá rychlost a jednoduchost, OSRM bleskově prosívá kandidáty, Google zajistí reálnou průchodnost a přesné časy. Přesně tahle kombinace umožní sestavovat itineráře, které se dají prodávat.
